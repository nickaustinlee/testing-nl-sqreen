/**
 * Copyright (c) 2016 - 2020 Sqreen. All Rights Reserved.
 * Please refer to our terms for more information: https://www.sqreen.io/terms.html
 */
'use strict';
const Code = require('code');
const Lab = require('lab');
const lab = exports.lab = Lab.script();

const describe = lab.describe;
const it = lab.it;
const expect = Code.expect;

const Ecosystem = require('../../../lib/ecosystem/index');
const agentInterface = Ecosystem.getInterface('agent');
const Exception = require('../../../lib/exception');

describe('Ecosystem', () => {

    describe('agentInterface', () => {

        it('should report an exception', { plan: 1 }, (done) => {

            const report = Exception.report;
            const error = new Error();
            Exception.report = function (err) {

                expect(err).to.equal(error);
                Exception.report = report;
                done();
                return Promise.reject();
            };
            agentInterface.reportError(error);
        });
    });
});
