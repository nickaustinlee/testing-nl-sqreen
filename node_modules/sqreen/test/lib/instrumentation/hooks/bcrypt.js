/**
 * Copyright (c) 2016 - 2020 Sqreen. All Rights Reserved.
 * Please refer to our terms for more information: https://www.sqreen.io/terms.html
 */
'use strict';
const Code = require('code');
const Lab = require('lab');
const lab = exports.lab = Lab.script();

const describe = lab.describe;
const it = lab.it;
const expect = Code.expect;

const Hook = require('../../../../lib/instrumentation/hooks/bcryptHook');
const NS = require('../../../../lib/instrumentation/hooks/ns').getNS();

describe('bcrypt hook', () => {

    it('should test the hook', { plan: 3 }, (done) => {


        const mod = {
            hash: function (a, b, cb) {

                if (typeof cb !== 'function') {
                    return Promise.resolve();
                }

                return cb(null, 'ok');
            },
            genSalt: function (n, cb) {

                return cb(null, 'salt');
            },
            compare: function (a, b, cb) {

                return cb(null, true);
            }
        };

        Hook({}, mod);

        NS.run(() => {

            NS.set('a', 'hello');

            expect(mod.hash.__wrapped).to.be.true();
            expect(mod.genSalt.__wrapped).to.be.true();
            expect(mod.compare.__wrapped).to.be.true();

            mod.hash(1, 2, () => {

                mod.hash('a');
                done();
            });
        });
    });
});

