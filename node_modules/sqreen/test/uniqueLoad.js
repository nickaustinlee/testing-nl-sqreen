/**
 * Copyright (c) 2016 - 2020 Sqreen. All Rights Reserved.
 * Please refer to our terms for more information: https://www.sqreen.io/terms.html
 */
'use strict';
const Code = require('code');
const Lab = require('lab');
const lab = exports.lab = Lab.script();

const describe = lab.describe;
const it = lab.it;
// const beforeEach = lab.beforeEach;
// const afterEach = lab.afterEach;
const expect = Code.expect;

const UniqueLoad = require('../uniqueLoad');

describe('uniqueLoad', () => {

    describe('canStart', () => {

        it('should check the number of time sqreen is loaded', { plan: 4 }, (done) => {

            let count = 0;
            process.on('sqreen_loaded_twice', (data) => {

                expect(count).to.equal(0);
                count++;

                expect(data).to.equal({ current: require('../version').version, existing: require('../version').version });
                done();
            });
            expect(UniqueLoad.canStart()).to.be.true();
            expect(UniqueLoad.canStart()).to.be.false();
        });
    });
});
